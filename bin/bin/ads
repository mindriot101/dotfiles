#!/usr/bin/env python
# -*- coding: utf-8 -*-

import argparse
import logging
import webbrowser
import urllib

logging.basicConfig(level=logging.INFO)

logger = logging.getLogger('ads')

QUERY = ("http://adsabs.harvard.edu/cgi-bin/nph-abs_connect?db_key=AST"
         "&qform=AST"
         "&sim_query=YES"
         "&ned_query=YES"
         "&adsobj_query=YES"
         "&aut_logic=OR"
         "&obj_logic=OR"
         "&author={author}"
         "&object="
         "&start_mon="
         "&start_year={year}"
         "&end_mon="
         "&end_year={year}"
         "&ttl_logic=OR"
         "&title="
         "&txt_logic=OR"
         "&text="
         "&nr_to_return=200"
         "&start_nr=1"
         "&jou_pick=ALL"
         "&ref_stems="
         "&data_and=ALL"
         "&group_and=ALL"
         "&start_entry_day="
         "&start_entry_mon="
         "&start_entry_year="
         "&end_entry_day="
         "&end_entry_mon="
         "&end_entry_year="
         "&min_score="
         "&sort=SCORE"
         "&data_type=SHORT"
         "&aut_syn=YES"
         "&ttl_syn=YES"
         "&txt_syn=YES"
         "&aut_wt=1.0"
         "&obj_wt=1.0"
         "&ttl_wt=0.3"
         "&txt_wt=3.0"
         "&aut_wgt=YES"
         "&obj_wgt=YES"
         "&ttl_wgt=YES"
         "&txt_wgt=YES"
         "&ttl_sco=YES"
         "&txt_sco=YES"
         "&version=1")


def author_list(authors):
    return urllib.quote('^' + '\n'.join(authors))

def main(args):
    if args.verbose:
        logger.setLevel(logging.DEBUG)

    logger.debug('Arguments: %s', args)

    encoded_author_list = author_list(args.author)
    logger.debug('Encoded author list: %s', encoded_author_list)

    url = QUERY.format(author=author_list(args.author), year=args.year)
    logger.debug('url: %s', url)

    webbrowser.open(url)

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('-y', '--year', type=int, required=True)
    parser.add_argument('-a', '--author', required=True, nargs='+')
    parser.add_argument('-v', '--verbose', action='store_true')
    main(parser.parse_args())
