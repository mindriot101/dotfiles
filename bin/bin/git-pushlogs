#!/bin/bash

set -eou pipefail

pushes() {
    local root_dir="$(git rev-parse --git-dir)"
    cat "${root_dir}/push-log" | sort -r
}

print_enriched_push() {
    local ts=$1
    local sha=$2

    local datetime="$(gdate -d @${ts} -Iseconds)"
    echo ${datetime}: $(git show --quiet ${sha} --oneline)
}

main() {
    pushes | while read push; do
        print_enriched_push $push
    done
}

main
