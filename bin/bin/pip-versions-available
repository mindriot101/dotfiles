#!/usr/bin/env bash
# -*- coding: utf-8 -*-

set -e

die() {
    echo "$@" >&2
    exit 1
}

has_executable() {
    if [[ $# != 1 ]]; then
        die "has_executable requires one argument"
    fi

    command -v $1 >/dev/null 2>/dev/null
}

ensure_program() {
    local readonly program="$1"
    if has_executable ${program}; then
        true
    else
        die "Cannot find ${program} on the PATH"
    fi
}

ensure_curl() {
    ensure_program curl
}

ensure_jq() {
    ensure_program jq
}

verify_args() {
    if [[ "$#" != 1 ]]; then
        die "Usage: $0 <packagename>"
    fi
}

print_package_versions() {
    local readonly package="$1"
    local readonly PACKAGE_JSON_URL="https://pypi.python.org/pypi/${package}/json"

    curl -sL "$PACKAGE_JSON_URL" | jq  -r '.releases | keys | .[]'
}

main() {
    ensure_jq
    ensure_curl
    verify_args "$@"
    local readonly package="$1"

    print_package_versions "${package}"
}

main "$@"
