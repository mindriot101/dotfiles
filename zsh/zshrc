for f in ~/.zsh/[0-9][0-9]*[^~]; do
    source $f
done

# Local (possibly secret) zshrc
if [[ -f ~/.zshrc.local ]]; then
    source ~/.zshrc.local
fi

is_plugin() {
    local base_dir=$1
    local name=$2
    test -f $base_dir/plugins/$name/$name.plugin.zsh \
        || test -f $base_dir/plugins/$name/_$name
}

# Add the plugins to the fpath variable
for plugin ($plugins); do
    if is_plugin ${HOME}/.zsh $plugin; then
        fpath=(${HOME}/.zsh/plugins/$plugin $fpath)
    fi
done

# Completion
autoload -U compinit && compinit
zstyle ':completion:*' menu select=20

# Load the plugins
for plugin ($plugins); do
    plugin_path=${HOME}/.zsh/plugins/${plugin}/${plugin}.plugin.zsh
    [[ -f $plugin_path ]] && source $plugin_path
done
