" turn syntax highlighting on
if &t_Co > 2 || has("gui_running")
    syntax on
endif

" Nice pathogen stuff
filetype off

let g:vundle_default_git_proto = 'git'

" Handle vundle here
set rtp+=~/.vim/bundle/vundle
call vundle#rc()

" Add bundles here
source ~/.vim/setup/bundles.vim

filetype plugin indent on
" Set no vi compatible
set nocompatible

" Enable matchit
runtime macros/matchit.vim

" set up some nice tab defaults
set tabstop=4
set softtabstop=4
set shiftwidth=4
set shiftround
set expandtab

" Set history settings
set history=700
set undolevels=700


" reload all file changes automatically
set autoread

" enable the semicolon to act like the colon key
noremap ; :

" set incremental search
set incsearch

" set case options for searching
set ignorecase
set smartcase

" Nice matching parentheses
set showmatch


" show command as it's typed
set showcmd


" nice file formatting
set autoindent


" line numbers
set number

" always have status line on
set laststatus=2
set encoding=utf-8 " Necessary to show unicode glyphs


" make backspace behave nicely
set backspace=indent,eol,start

" Set mouse mode
set mouse=a

" Auto-clean fugitive buffers
autocmd BufReadPost fugitive://* set bufhidden=delete

" Remap the move-window keys
map <C-h> <C-w>h
map <C-j> <C-w>j
map <C-k> <C-w>k
map <C-l> <C-w>l

" Remove the arrow key functionality
nnoremap <Up> <nop>
nnoremap <Down> <nop>
nnoremap <Left> <nop>
nnoremap <Right> <nop>
inoremap <Up> <nop>
inoremap <Down> <nop>
inoremap <Left> <nop>
inoremap <Right> <nop>

" better line movement
nnoremap j gj
nnoremap k gk

" disable f1 key
inoremap <F1> <ESC>
nnoremap <F1> <ESC>
vnoremap <F1> <ESC>

" Set Ultisnips comment style
let g:ultisnips_python_style='doxygen'

" Set the tags directory
set tags=./tags;/

" Set tags executable
if has("macunix")
    " Have to change this for my laptop
    let Tlist_Ctags_Cmd='/usr/local/bin/ctags'
endif

" Shortcut for the tag list 
map <leader><Tab> :TagbarToggle<CR>

" Reselect visual block after indent/outdent
vnoremap < <gv
vnoremap > >gv

" Enable fast tty mode
set ttyfast

" Change the way tab autocompletion works
set wildmenu
set wildmode=list:longest,list:full

" Remap the Q key
map Q gq

" Make the Y key work
map Y y$

" Change the ctrlp plugin key combo, and the default function to search in
" buffers also
let g:ctrlp_map = '<leader>t'
let g:ctrlp_cmd = 'CtrlPMixed'

" Add some fugitive leader commands
noremap <leader>gd :Gdiff<CR>
noremap <leader>gw :Gwrite<CR>
noremap <leader>gr :Gread<CR>
noremap <leader>gc :Gcommit<CR>
noremap <leader>gst :Gst<CR>

" If a .local.vim file exists in the cwd then source it
if filereadable(".local.vim")
    source .local.vim
endif

" Use double j to escape
inoremap jj <ESC>

" Paste toggling - allow for pasting from other sources with correct
" formatting
set pastetoggle=<leader>p

" Disable escape keys which makes vim more responsive
" set noesckeys

" Hide buffers instead of closing them
set hidden

" Don't update the display while executing macros
set lazyredraw

" Set up statusline
set statusline=

" Buffer number and pipe character with spaces
set statusline+=%-3.3n\ 

" Filename relative to opening path
set statusline+=%f\ 

" Status markers
set statusline+=%h%m%r%q

" Git status
set statusline+=%{fugitive#statusline()}

" End of left section, start right section
set statusline+=%=

" File type
set statusline+=%y\ 

" Cursor position
set statusline+=%-14.(%l,%c%V%)\ 

" View position
set statusline+=%P

" Vimux mappings
map <leader>vm :VimuxPromptCommand<CR>
map <leader>vr :VimuxRunLastCommand<CR>

" Folding method
set foldmethod=marker

" Thesaurus
set thesaurus+=~/thesaurus/mthesaur.txt

" Change directory to that of the current file
" Taken from Dave Aitken http://www.github.com/actionshrimp
map <leader>cd :cd %:p:h<CR>:pwd<CR>

" Tube
if has("macunix")
		let g:tube_terminal = 'iterm'
endif

" Latexbox ignore warnings
let g:LatexBox_show_warnings = 0

" Disable folding
let g:LatexBox_fold_envs = 0

" Set colour scheme
if &t_Co >= 256 || has("gui_running")
    set background=dark
		" colorscheme solarized
    colorscheme lucius
endif

" Ctrl-P ignore list
set wildignore+=*.pyc
set wildignore+=*.aux
set wildignore+=venv/*

" Add a command to list the recent files using ctrlp's mru feature
command! Recent execute "CtrlPMRU"

" Disable backup files
set nobackup
set nowritebackup
set noswapfile

" Leader command for clearing all other buffers
map <leader>bo :BufOnly<CR>

" Map control-s to update, rather than write
nmap <C-s> :update<CR>
imap <C-s> :update<CR>
vmap <C-s> :update<CR>

" Map leader r to recent command
map <leader>r :Recent<CR>

" Open nerdtree with leader command
map <leader>nt :NERDTreeToggle<CR>

" Enable british spelling
set spelllang=en_gb

" Better formatting
set formatprg=par

" Set up haskell mode
au BufEnter *.hs compiler ghc
let g:haddock_browser = "open"
let g:haddock_browser_callformat = "%s %s"

" Configure the keys for altr
command! A call altr#forward()
